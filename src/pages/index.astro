---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import ReportCard from '../components/ReportCard.astro';
import { leagues } from '../data/leagues';

// Load all reports
const reportModules = import.meta.glob('../data/reports/**/*.json', { eager: true });
const allReports = (Object.values(reportModules) as any[]).sort((a, b) =>
  b.date.localeCompare(a.date)
);

const base = import.meta.env.BASE_URL.replace(/\/$/, '');
---

<Layout title="Home">
  <Header />

  <main class="max-w-6xl mx-auto px-6 py-12">

    <!-- Hero -->
    <div class="mb-14">
      <p class="text-xs font-semibold uppercase tracking-widest text-[#e94560] mb-3">
        Sharps Intelligence
      </p>
      <h1 class="text-3xl md:text-4xl font-bold text-white mb-3 leading-tight">
        Football Betting Analysis<br />Powered by AI
      </h1>
      <p class="text-gray-400 text-base max-w-xl leading-relaxed">
        Institutional-grade xG regression alerts, sharp money signals and value plays â€”
        published automatically every Friday &amp; Monday.
      </p>
    </div>

    <!-- Leagues -->
    <section class="mb-14">
      <h2 class="text-xs font-semibold uppercase tracking-widest text-gray-500 mb-5">Leagues</h2>
      <div class="grid grid-cols-3 sm:grid-cols-6 gap-3">
        {leagues.map((league) => (
          <a
            href={league.active ? `${base}/${league.slug}` : undefined}
            class={`rounded-xl p-4 text-center border transition-all duration-200 ${
              league.active
                ? 'border-gray-700 bg-[#1a1a1a] hover:border-[#e94560]/60 hover:bg-[#1f1f1f] cursor-pointer'
                : 'border-gray-900 bg-[#111] opacity-40 cursor-default'
            }`}
          >
            <div class="text-2xl mb-1.5">{league.flag}</div>
            <div class="text-xs font-semibold text-gray-300">{league.shortName}</div>
            {league.active ? (
              <div class="mt-1.5 flex items-center justify-center gap-1">
                <span class="w-1.5 h-1.5 bg-green-500 rounded-full inline-block"></span>
                <span class="text-xs text-green-600">Live</span>
              </div>
            ) : (
              <div class="text-xs text-gray-700 mt-1.5">Soon</div>
            )}
          </a>
        ))}
      </div>
    </section>

    <!-- Latest Reports -->
    <section>
      <h2 class="text-xs font-semibold uppercase tracking-widest text-gray-500 mb-5">
        Latest Reports
      </h2>

      {allReports.length === 0 ? (
        <div class="rounded-xl border border-gray-800 bg-[#1a1a1a] p-12 text-center">
          <p class="text-gray-500 text-sm">No reports published yet.</p>
          <p class="text-gray-700 text-xs mt-2">The bot publishes every Friday &amp; Monday.</p>
        </div>
      ) : (
        <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
          {allReports.slice(0, 6).map((report) => {
            const league = leagues.find((l) => l.slug === report.league);
            return (
              <ReportCard
                report={report}
                leagueFlag={league?.flag}
                leagueName={league?.name}
                href={`${base}/${report.league}/${report.id}/`}
              />
            );
          })}
        </div>
      )}
    </section>

  </main>
</Layout>
